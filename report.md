# Simple Docker

## Part 1. Готовый докер

**== Задание ==**

1. Взять официальный докер образ с **nginx** и выкачать его при помощи `docker pull`
2. Проверить наличие докер образа через `docker images`
3. Запустить докер образ через `docker run -d [image_id|repository]`
4. Проверить, что образ запустился через `docker ps`
5. Посмотреть информацию о контейнере через `docker inspect [container_id|container_name]`
6. По выводу команды определить и поместить в отчёт размер контейнера, список замапленных портов и ip контейнера
7. Остановить докер образ через `docker stop [container_id|container_name]`
8. Проверить, что образ остановился через `docker ps`
9. Запустить докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду *run*
10. Проверить, что в браузере по адресу *localhost:80* доступна стартовая страница **nginx**
11. Перезапустить докер контейнер через `docker restart [container_id|container_name]`
12. Проверить любым способом, что контейнер запустился
    - В отчёт поместить скрины:
        - вызова и вывода всех использованных в этой части задания команд;
        - стартовой страницы **nginx** по адресу *localhost:80* (адрес должен быть виден).

*Замечание:* **Не загружайте тяжелые файлы (>10 мб) в гит.**

**== Решение ==**

1. Установить докер `sudo apt install [docker.io](http://docker.io/)`
    
    `sudo groupadd docker`
    
    `sudo usermod -aG docker johannec`
    
    `su -s johannec`
    
2. Взять официальный докер образ с **nginx** и выкачать его при помощи `docker pull`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled.png)
    
3. Проверить наличие докер образа через `docker images`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%201.png)
    
4. Запустить докер образ через `docker run -d [image_id|repository]`. Проверить, что образ запустился через `docker ps`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%202.png)
    
5. Посмотреть информацию о контейнере через `docker inspect [container_id|container_name]`
    
    Поместить в отчёт размер контейнера, список замапленных портов и ip контейнера
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%203.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%204.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%205.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%206.png)
    
6. Остановить докер образ через `docker stop [container_id|container_name]`Проверить, что образ остановился через `docker ps`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%207.png)
    
7. Запустить докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду *run*
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%208.png)
    
8. Проверить, что в браузере по адресу *localhost:80* доступна стартовая страница **nginx**
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%209.png)
    
9. Перезапустить докер контейнер через `docker restart [container_id|container_name].`Проверить любым способом, что контейнер запустился.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2010.png)
    

## Part 2. Операции с контейнером

**== Задание ==**

1. Прочитать конфигурационный файл *nginx.conf* внутри докер контейнера через команду *exec*
2. Создать на локальной машине файл *nginx.conf*
3. Настроить в нем по пути */status* отдачу страницы статуса сервера **nginx**
4. Скопировать созданный файл *nginx.conf* внутрь докер образа через команду `docker cp`
5. Перезапустить **nginx** внутри докер образа через команду *exec*
6. Проверить, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**
7. Экспортировать контейнер в файл *container.tar* через команду *export*
8. Остановить контейнер
9. Удалить образ через `docker rmi [image_id|repository]`, не удаляя перед этим контейнеры
10. Удалить остановленный контейнер
11. Импортировать контейнер обратно через команду *import*
12. Запустить импортированный контейнер
13. Проверить, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**
    - В отчёт поместить скрины:
        - вызова и вывода всех использованных в этой части задания команд;
        - содержимое созданного файла *nginx.conf*;
        - страницы со статусом сервера **nginx** по адресу *localhost:80/status*.

**== Решение ==**

1. Прочитать конфигурационный файл *nginx.conf* внутри докер контейнера через команду *exec*
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2011.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2012.png)
    
2. Создать на локальной машине файл *nginx.conf.* Настроить в нем по пути */status* отдачу страницы статуса сервера **nginx**
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2013.png)
    
3. Скопировать созданный файл *nginx.conf* внутрь докер образа через команду `docker cp`. Перезапустить **nginx** внутри докер образа через команду *exec.* Проверить, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2014.png)
    
4. Экспортировать контейнер в файл *container.tar* через команду *export.* Остановить контейнер.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2015.png)
    
5. Удалить образ через `docker rmi [image_id|repository]`, не удаляя перед этим контейнеры. Удалить остановленный контейнер.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2016.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2017.png)
    
6. Импортировать контейнер обратно через команду *import.* Запустить импортированный контейнер.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2018.png)
    

## Part 3. Мини веб-сервер

**== Задание ==**

1. Написать мини сервер на **C** и **FastCgi**, который будет возвращать простейшую страничку с надписью `Hello World!`
2. Запустить написанный мини сервер через *spawn-fcgi* на порту 8080
3. Написать свой *nginx.conf*, который будет проксировать все запросы с 81 порта на *127.0.0.1:8080*
4. Проверить, что в браузере по *localhost:81* отдается написанная вами страничка
5. Положить файл *nginx.conf* по пути *./nginx/nginx.conf* (это понадобится позже)

**== Решение ==**

1. Написать мини сервер на **C** и **FastCgi**, который будет возвращать простейшую страничку с надписью `Hello World!`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2019.png)
    
2. Запустить написанный мини сервер через *spawn-fcgi* на порту 8080.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2020.png)
    
3. Написать свой *nginx.conf*, который будет проксировать все запросы с 81 порта на *127.0.0.1:8080.* Положить файл *nginx.conf* по пути *./nginx/nginx.conf* (это понадобится позже).
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2021.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2022.png)
    
4. Проверить, что в браузере по *localhost:81* отдается написанная вами страничка
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2023.png)
    

## Part 4. Свой докер

**== Задание ==**

1. *При написании докер образа избегайте множественных вызовов команд RUN*
2. Написать свой докер образ, который:
    - собирает исходники мини сервера на FastCgi из [Части 3](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21)
    - запускает его на 8080 порту
    - копирует внутрь образа написанный *./nginx/nginx.conf*
    - запускает **nginx**.
3. ***nginx** можно установить внутрь докера самостоятельно, а можно воспользоваться готовым образом с **nginx**'ом, как базовым.*
4. Собрать написанный докер образ через `docker build` при этом указав имя и тег
5. Проверить через `docker images`, что все собралось корректно
6. Запустить собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки *./nginx* внутрь контейнера по адресу, где лежат конфигурационные файлы **nginx**'а (см. [Часть 2](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21))
7. Проверить, что по localhost:80 доступна страничка написанного мини сервера
8. Дописать в *./nginx/nginx.conf* проксирование странички */status*, по которой надо отдавать статус сервера **nginx**
9. Перезапустить докер образ
10. *Если всё сделано верно, то, после сохранения файла и перезапуска контейнера, конфигурационный файл внутри докер образа должен обновиться самостоятельно без лишних действий*

**== Решение ==**

1. Написать свой докер образ, который:
    - собирает исходники мини сервера на FastCgi из [Части 3](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21)
    - запускает его на 8080 порту
    - копирует внутрь образа написанный *./nginx/nginx.conf*
    - запускает **nginx**.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2024.png)
    
2. Собрать написанный докер образ через `docker build` при этом указав имя и тег.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2025.png)
    
3. Проверить через `docker images`, что все собралось корректно.
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2026.png)
    
4. Запустить собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки *./nginx* внутрь контейнера по адресу, где лежат конфигурационные файлы **nginx**'а (см. [Часть 2](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21))
    
    docker run -p 80:81 -v $PWD/nginx:/etc/nginx ng_serv:ver10
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2027.png)
    
5. Проверить, что по localhost:80 доступна страничка написанного мини сервера. Дописать в *./nginx/nginx.conf* проксирование странички */status*, по которой надо отдавать статус сервера **nginx**
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2028.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2029.png)
    
6. Перезапустить докер образ. *Если всё сделано верно, то, после сохранения файла и перезапуска контейнера, конфигурационный файл внутри докер образа должен обновиться самостоятельно без лишних действий*
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2030.png)
    

## Part 5. **Dockle**

**== Задание ==**

1. Просканировать образ из предыдущего задания через `dockle [image_id|repository]`
2. Исправить образ так, чтобы при проверке через **dockle** не было ошибок и предупреждений

**== Решение==**

1. Просканировать образ из предыдущего задания через `dockle [image_id|repository]`
    
    [https://linux.how2shout.com/how-to-install-brew-ubuntu-20-04-lts-linux/](https://linux.how2shout.com/how-to-install-brew-ubuntu-20-04-lts-linux/)
    
    dockle serv:ver10
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2031.png)
    
2. Исправить образ так, чтобы при проверке через **dockle** не было ошибок и предупреждений
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2032.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2033.png)
    

## Part 6. Базовый **Docker Compose**

**== Задание ==**

1. Написать файл *docker-compose.yml*, с помощью которого:
    1. Поднять докер контейнер из [Части 5](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21) *(он должен работать в локальной сети, т.е. не нужно использовать инструкцию **EXPOSE** и мапить порты на локальную машину)*
    2. Поднять докер контейнер с **nginx**, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера
2. Замапить 8080 порт второго контейнера на 80 порт локальной машины
3. Остановить все запущенные контейнеры
4. Собрать и запустить проект с помощью команд `docker-compose build` и `docker-compose up`
5. Проверить, что в браузере по *localhost:80* отдается написанная вами страничка, как и ранее

**== Решение==**

1. Написать файл *docker-compose.yml*, с помощью которого:
    1. Поднять докер контейнер из [Части 5](https://www.notion.so/Simple-Docker-4135d52579034e36b5651b95a873e266?pvs=21) *(он должен работать в локальной сети, т.е. не нужно использовать инструкцию **EXPOSE** и мапить порты на локальную машину)*
        
        ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2034.png)
        
    2. Поднять докер контейнер с **nginx**, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера
        
        ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2035.png)
        
        ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2036.png)
        
2. Замапить 8080 порт второго контейнера на 80 порт локальной машины
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2037.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2038.png)
    
3. Остановить все запущенные контейнеры
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2039.png)
    
4. Собрать и запустить проект с помощью команд `docker-compose build` и `docker-compose up`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2040.png)
    
    `docker-compose build`
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2041.png)
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2042.png)
    
5. Проверить, что в браузере по *localhost:80* отдается написанная вами страничка, как и ранее
    
    ![Untitled](Simple%20Docker%204135d52579034e36b5651b95a873e266/Untitled%2043.png)